# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.
View - слой представления, отвечает за отображение данных на странице.
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`
`setText(element: HTMLElement, value: unknown)` - утилитарный метод добавления текстав DOM-элемент
`toggleClass(element: HTMLElement, className: string, force?: boolean)` - утилитарный метод переключения класса DOM-элемента

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:
`baseUrl: string` - базовый адрес сервера
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### Интерфейс IProduct

Описывает карточку товара, содержащую основную информацию о продукте.

Свойства:
`id: string` - уникальный идентификатор товара
`description: string` - описание товара
`image: string` - путь до файла картинки товара
`title: string` - название товара
`category: string` - категория товара
`price: number | null` - цена товара, может быть или числом или не иметь стоимости

#### Интерфейс IBuyer

Описывает данные покупателя
`payment: PaymentMethod` - тип оплаты, может быть только или наличными, или картой, или не иметь типа, если товар без цены
`email: string` - электронная почта покупателя
`phone: string` - телефон покупателя
`address: string` - адрес покупателя

#### Интерфейс IBuyerValidation

Описывает результат валидации
`address: string` - валидность адреса
`email: string` - валидность email
`phone: string` - валидность номера телефона
`payment: string` - валидность способа оплаты

#### Интерфейс IResponseProducts

Расширяет интерфейс IProduct для корректной обработки данных, полученных с сервера
`total: number` - общее количесвто товаров в каталоге
`items: IProduct[]` - массив с товарами каталога

#### Интерфейс IPostOrder

Раширяет интерфейс IBuyer для добавления массива данных корзины покупателя и общей суммы товаров в ней
`total: number` - общая стоимость товаров в корзине
`items: string[]` - массив с id товаров, купленных пользователем

### Модели данных

#### Класс Catalog

Служит для хранения коллекции всех товаров, хранения информации о выбранном товаре для подробного отображения.

Поля класса:
`products: IProduct[]` - массив товаров, содержащихся в каталоге
`productCard: Iproduct` - выбранная карточка товара

В конструктор класса `constructor(protected events: EventEmitter)` передается эмиттер событий для взаимодействия с другими компонентами

Методы класса:
`setProducts(products: IProduct[])` - сохраняет массив товаров
`getProducts(): IProduct[]` - возвращает массив товаров
`getProduct(): Iproduct` - получить выбранную карточку
`setProductCard(id: string)` - сохранить выбранную карточку
`getProductById(id: string): IProduct | undefind` - получение товара из каталога по id

#### Класс Cart

Служит для хранения коллекции выбранных пользователем товаров

В конструктор класса `constructor(protected events: EventEmitter)` передается эмиттер событий для взаимодействия с другими компонентами

Поля класса:
`products: IProduct[]` - массив товаров, добавленных пользователем в корзину

Методы класса:
`addProduct(product: IProduct)` - добавляет товар в корзину
`deleteProduct(id: string)` - удаляет товар из корзины
`clearCart()` - полностью очищает корзину
`getTotal(): number` - возвращает количество товаров в корзине
`getProducts(): IProduct[]` - возвращает массив товаров, находящихся в корзине
`getTotalSum(): number` - возвращает общую стоимость товаров в корзине
`getProductExist(id: string): boolean` - проверяет наличие товара в корзине

#### Класс Buyer

Служит для хранения данных покупателя и их валидацией перед отправкой на сервер

В конструктор класса `constructor(protected events: EventEmitter, initialData?: Partial<IBuyer>)` передается объект с необязательными полями, эмиттер событий для взаимодействия с другими компонентами

Поля класса:
`buyerData: IBuyer` - данные покупателя

Методы класса:

`saveData(patch: Partial<IBuyer>): void` - обновляет данные покупателя
`getData(): IBuyer` - возвращает данные покупателя
`validateOrder(): IBuyerValidation` - валидирует данные покупателя
`clearData()` - удаляет данные покупателя

### Слой коммуникации

#### Класс ProductsApi

Служит для получения и отправки данных на сервер.

Поля класса:
`api: Api` - базовый класс Api
`constructor(api: Api)` - в конструктор класса передается экземпляр класса Api, реализующего базовую логику отправки запросов

Методы класса:

`getProducts(): Promise` - получение массива данных товаров с сервера
`postOrder(): Promise` - отправка данных покупателя на сервер

### Классы Представления

#### Класс Gallery
Класс галереи карточек товаров, отвечает за отображение каталога

##### Интерфейс IGallery
Описывает поля для рендера каталога

`catalog: HTMLElement[]` - массив элементов каталога товаров
`locked: boolean` - флаг блокировки страницы

В конструктор класса передается:
`container: HTMLElement` - элемент разметки

Методы класса:

`set catalog(items: HTMLElement[])` - устанавливает элементы каталога в галерею

#### Класс BaseCard

Базовый класс карточки товара

##### Интерфейс IBaseCard
Описывает данные для рендера карточки

`title: string` - поле заголовка карточки
`price: number | null | string` - поле стоимости товара

В конструктор класса `container: HTMLElement` передается элемент разметки

Методы класса:

`set title(value: string)` - устанавливает заголовок карточки в разметку
`set price(value: number | null)` - устанавливает цену товара в разметку

#### Класс CatalogCard
Класс карточки товара для каталога, расширяет базовый класс карточки

##### Интерфейс ICatalogCard
Описывает данные для рендера карточки каталога
`image: string` - поле изображения товара
`category: string` - поле категории товара

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`actions?: ICardActions` - дополнительные действия с карточкой

Методы класса:

`set image(value: string)` - устанавливает изображение карточки в разметку
`set category(value: string)` - устанавливает категорию товара в разметку.

#### Класс PreviewCard
Класс карточки предпросмотра товара

##### Интерфейс IPrewiewCard
Описывает данные для рендера карточки предпросмотра. Расширяет интерфейс ICatalogCard.

`description: string` - поле описания товара
`buttonText: string` - поле текста кнопки
`attribute: string` - поле атрибута кнопки

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`actions?: ICardActions` - дополнительные действия с карточкой (опционально)

Методы класса:

`set description(value: string)` - устанавливает описание товара в разметку
`set buttonText(value: string)` - устанавливает текст кнопки добавления/удаления
`set attribute(value: string)` - устанавливает атрибут кнопки добавления/удаления

#### Класс BasketCard
Класс карточки товара в корзине, расширяет базовый класс карточки

##### Интерфейс IBasketCard
Описывает данные для рендера карточки в корзине

`index: number` - поле индекса товара в корзине

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`actions?: ICardActions` - дополнительные действия с карточкой

Методы класса:

`set index(value: number)` - устанавливает индекс товара в корзине в разметку

#### Класс Basket
Отвечает за отображение корзины товаров

##### Интерфейс IBasket
Описывает состояние корзины

`basketList: HTMLElement[]` - массив элементов списка товаров в корзине
`basketEmptyElement: HTMLElement` - элемент отображения пустой корзины
`total: number` - общая стоимость товаров в корзине
`disabled: string` - атрибут блокировки кнопки оформления заказа
`abled: string` - атрибут разблокировки кнопки оформления заказа

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`events: EventEmitter` - эмиттер событий для взаимодействия с другими компонентами

Методы класса:

`set basketEmptyElement(value: HTMLElement)` - устанавливает элемент отображения пустой корзины
`set basketList(items: HTMLElement[])` - устанавливает список товаров в корзине
`set total(value: number)` - устанавливает общую стоимость товаров в корзине
`set disabled(value: string)` - блокирует кнопку оформления заказа
`set abled(value: string)` - разблокирует кнопку оформления заказа

#### Класс BaseForm
Базовый класс формы. Отвечает за базовую функциональность форм.

##### Интерфейс IBaseForm
Описывает базовое состояние формы.

`valid: boolean` - флаг валидности формы
`errors: string[]` - массив ошибок валидации

В конструктор класса передаются:
`container: HTMLFormElement` - элемент формы
`events: EventEmitter` - эмиттер событий для взаимодействия с другими компонентами

Методы класса:

`set valid(value: boolean)` - устанавливает валидность формы (блокирует/разблокирует кнопку отправки)
`set errors(value: string[])` - устанавливает ошибки валидации в разметку

#### Класс OrderForm
Класс формы оформления заказа

##### Интерфейс IOrderForm
Описывает состояние формы заказа

`address: string` - поле адреса доставки
`payment: string` - поле способа оплаты

Методы класса:

`set payment(value: string)` - устанавливает выбранный способ оплаты и переключает активное состояние кнопок
`set address(value: string)` - устанавливает значение адреса в поле ввода

#### Класс ContactsForm
Класс формы контактов. Расширяет базовый класс формы, добавляя функциональность ввода email и телефона.

##### Интерфейс IContactsForm
Описывает состояние формы контактов

`email: string` - поле email
`phone: string` - поле телефона

Методы класса:

`set email(value: string)` - устанавливает значение email в поле ввода
`set phone(value: string)` - устанавливает значение телефона в поле ввода

#### Класс Header
Класс шапки приложения. Отвечает за отображение счетчика товаров в корзине и открытие корзины.

##### Интерфейс IHeader
Описывает состояние шапки приложения.

`counter: number` - количество товаров в корзине

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`events: EventEmitter` - эмиттер событий для взаимодействия с другими компонентами

Методы класса:

`set counter(value: number)` - устанавливает количество товаров в корзине в счетчик

#### Класс ModalWindow
Класс модального окна. Отвечает за отображение и управление модальными окнами приложения.

##### Интерфейс IModalWindow
Описывает состояние модального окна.

`content: HTMLElement` - содержимое модального окна

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`events: EventEmitter` - эмиттер событий для взаимодействия с другими компонентами

Методы класса:

`set content(value: HTMLElement)` - устанавливает содержимое модального окна
`open()` - открывает модальное окно
`close()` - закрывает модальное окно

#### Класс OrderSuccess
Класс успешного оформления заказа. Отвечает за отображение информации о успешно завершенном заказе.

##### Интерфейс IOrderSuccess
Описывает состояние экрана успешного заказа.

`amount: number` - сумма списанных средств за заказ

В конструктор класса передаются:
`container: HTMLElement` - элемент разметки
`events: EventEmitter` - эмиттер событий для взаимодействия с другими компонентами

Методы класса:

`set amount(value: number)` - устанавливает сумму списанных средств в разметку

### События

`catalog:changed` - отрисовка каталога товаров

#### События карточек товаров
`'card:select'` - выбор карточки товара

`'product:add'` - добавление товара в корзину

`'product:delete'` - удаление товара из корзины

#### События корзины
`'basket:open'` - открытие корзины

`'cart:changed'` - изменение состояния корзины

#### События оформления заказа
`'order:open'` - открытие формы заказа

`'order:submit'` - отправка формы заказа

`'order:end'` - завершение заказа

`'order.payment:change'` - изменение способа оплаты

#### События форм
`'formErrors:change'` - изменение ошибок валидации

`'contacts:submit'` - отправка формы контактов

#### Регулярные выражения событий
`/^order\..*:change/` - изменение полей формы заказа

`/^contacts\..*:change/` - изменение полей формы контактов

### Презентер

Код презентера не выделяется в отдельный класс, а содержится в основном скрипте приложения main.ts

Каталог товаров загружается с сервера при запуске приложения

#### Слушатель события catalog:changed
После загрузки или изменения каталога создает карточки товаров с обработчиками клика

#### Слушатель события card:select
Параметры: `item: IProduct` - данные выбранного товара
Открывает модальное окно с предпросмотром товара, управляет состоянием кнопки добавления в корзину, сохраняет выбранный товар

#### Слушатель события basket:open
Открывает модальное окно с содержимым корзины

#### Слушатель события cart:changed
Обновляет отображение корзины при каждом изменении данных в модели корзины, подсчитывает общую сумму и количество товаров

#### Слушатель события product:add
Добавляет текущий товар в корзину

#### Слушатель события product:delete
Параметры: `item: IProduct` - данные удаляемого товара
Удаляет товар из корзины по ID

#### Слушатель события order:open
Открывает модальное окно с формой оформления заказа

#### Слушатель события formErrors:change
Параметры: `errors: Partial<IBuyerValidation>` - объект с ошибками валидации
Обновляет отображение ошибок в формах заказа и контактов

#### Слушатель события /^order\..*:change/
Параметры: `data: { field: keyof IBuyer, value: string }` - поле и значение
Сохраняет изменения в данных покупателя

#### Слушатель события /^contacts\..*:change/
Параметры: `data: { field: keyof IBuyer, value: string }` - поле и значение
Сохраняет изменения в данных покупателя

#### Слушатель события order:submit
Переходит к форме контактов после заполнения данных заказа

#### Слушатель события contacts:submit
Формирует и отправляет данные заказа на сервер, очищает корзину, показывает окно успешного завершения заказа

#### Слушатель события order.payment:change
Параметры: `data: { payment: PaymentMethod }` - выбранный способ оплаты
Сохраняет выбранный способ оплаты и обновляет интерфейс

#### Слушатель события 'order:end'
Действие: Закрывает модальное окно после успешного оформления









